<!-- Servo Control Plugin Settings -->

<!-- Servo Control Section -->
<fieldset class="form-group">
    <legend class="section-title">Servo Control</legend>
    
    <div class="form-group">
        <label for="gpio-pin" class="form-label">GPIO Pin Number:</label>
        <input 
            type="number" 
            id="gpio-pin" 
            name="gpio_pin" 
            class="form-control" 
            value="18"
            required
        />
        <small class="form-text">GPIO pin where the servo signal wire is connected (default: 18, other Pins not tested, perhaps need more configuration)</small>
    </div>

    <div class="form-group">
        <label for="target-angle" class="form-label">Target Angle: </label>
        <input 
            type="number" 
            id="target-angle" 
            name="target_angle" 
            min="-45" 
            max="135" 
            value="45"
            step="1"
        />
        <span id="angle-display">45°</span>
        <small class="form-text">
            Drag the slider to set target servo angle (<span id="angle-min">-45</span>° - <span id="angle-max">135</span>°)
        </small>
    </div>

    <div class="form-group">
        <label for="servo-speed" class="form-label">Servo Speed: </label>
        <input 
            type="number" 
            id="servo-speed" 
            name="servo_speed"  
            min="0" 
            value="35"
        />
        <small class="form-text">Delay between angle steps in milliseconds (lower = faster)</small>
    </div>
</fieldset>

<!-- Device Config Section -->
<fieldset class="form-group">
    <legend class="section-title">Device Config</legend>
    
    <div class="form-group">
        <label for="orientation" class="form-label">Orientation:</label>
        <select 
            id="orientation" 
            name="orientation" 
            class="form-control"
        >
            <option value="current">Keep Current</option>
            <option value="landscape">Landscape (Horizontal)</option>
            <option value="portrait">Portrait (Vertical)</option>
        </select>
        <small class="form-text">
            Update device orientation when servo moves. 
            "Keep Current" will not change the display orientation.
        </small>
    </div>

    <div class="form-group">
        <label class="form-label" for="inverted_image">Invert Image</label>
        <input type="checkbox" id="inverted_image" name="inverted_image">
        <small class="form-text">Invert the display output.</small>
    </div>
</fieldset>

<!-- Display Options Section -->
<fieldset class="form-group">
    <legend class="section-title">Display Options</legend>
    
    <div class="form-group">
        <label class="form-label" for="show_test_image">Show Test Image</label>
        <input type="checkbox" id="show_test_image" name="show_test_image">
        <small class="form-text">Display a virtual horizon test image that appears level when the screen is physically rotated to match the servo angle.</small>
    </div>
</fieldset>

<!-- API Example Section -->
<details class="api-example-section">
    <summary class="api-example-title">API Example</summary>
    <div class="api-example-content">
        <p>Example POST request to update servo control settings:</p>
        <pre id="api-example-code"><code>curl -X POST http://inkypi.local/update_now \
  -d "plugin_id=servo_control&gpio_pin=18&target_angle=45&servo_speed=35&orientation=current&inverted_image=false&show_test_image=false"</code></pre>
    </div>
</details>

<script>

    // Update API example code
    function updateApiExample() {
        const formData = new URLSearchParams();
        formData.append('plugin_id', 'servo_control');
        formData.append('gpio_pin', document.getElementById('gpio-pin').value);
        formData.append('target_angle', document.getElementById('target-angle').value);
        formData.append('servo_speed', document.getElementById('servo-speed').value);
        formData.append('orientation', document.getElementById('orientation').value);
        formData.append('inverted_image', document.getElementById('inverted_image').checked);
        formData.append('show_test_image', document.getElementById('show_test_image').checked);
        
        const curlCommand = `curl -X POST http://inkypi.local/update_now \\
  -d "${formData.toString()}"`;
        
        const codeElement = document.getElementById('api-example-code');
        codeElement.textContent = curlCommand;
    }
    
    // Update angle display
    document.getElementById('target-angle').addEventListener('input', function() {
        document.getElementById('angle-display').textContent = this.value + '°';
        updateApiExample();
    });
    
    // Update speed display
    document.getElementById('servo-speed').addEventListener('input', function() {
        document.getElementById('speed-display').textContent = this.value + 'ms';
        updateApiExample();
    });
    
    // Update API example on other field changes
    document.getElementById('gpio-pin').addEventListener('input', updateApiExample);
    document.getElementById('orientation').addEventListener('change', updateApiExample);
    document.getElementById('inverted_image').addEventListener('change', updateApiExample);
    document.getElementById('show_test_image').addEventListener('change', updateApiExample);
    
    // Load settings from pluginSettings
    document.addEventListener('DOMContentLoaded', () => {
        // Check if we're in edit mode and have existing settings
        if (loadPluginSettings && typeof pluginSettings !== 'undefined' && pluginSettings) {
            // Load GPIO pin
            if (pluginSettings.gpio_pin !== undefined) {
                document.getElementById('gpio-pin').value = pluginSettings.gpio_pin;
            }
            
            // Load target angle
            if (pluginSettings.target_angle !== undefined) {
                const angle = pluginSettings.target_angle;
                document.getElementById('target-angle').value = angle;
                document.getElementById('angle-display').textContent = angle + '°';
            }
            
            // Load servo speed
            if (pluginSettings.servo_speed !== undefined) {
                const speed = pluginSettings.servo_speed;
                document.getElementById('servo-speed').value = speed;
                document.getElementById('speed-display').textContent = speed + 'ms';
            }
            
            // Load orientation
            if (pluginSettings.orientation !== undefined) {
                document.getElementById('orientation').value = pluginSettings.orientation;
            }

            // Load invert image
            if (pluginSettings.inverted_image !== undefined) {
                document.getElementById('inverted_image').checked = !!pluginSettings.inverted_image;
            }

            // Load show test image
            if (pluginSettings.show_test_image !== undefined) {
                document.getElementById('show_test_image').checked = !!pluginSettings.show_test_image;
            }
            
            // Update API example after loading all settings
            updateApiExample();
        }
    });
</script>
